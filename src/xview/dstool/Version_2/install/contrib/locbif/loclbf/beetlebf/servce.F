C  -------------------------------------------------------------------
C
C	Copyright (1990-1995) by Alexander Khibnik, Yuri Kuznetsov, and 
C	Eugene Nikolaev.
C
C The Locbif computation code in DsTool is distributed in the hope that it  
C will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty  
C of FITNESS FOR A PARTICULAR PURPOSE.  The software is provided as is without 
C any obligation on the part of Locbif authors, Cornell faculty, 
C Cornell staff or Cornell students to assist in its use, correction, 
C modification or enhancement. 
C
C  -------------------------------------------------------------------

      SUBROUTINE SERVCE (ISTEP,NX,NDIMM,NG,NCAN,ICRS,NUF,IFUNS,NUE,
     A		 IVARS,IPRNT,XCRV,EPS,FUN,DFDX,OUT,DFUN,ISTOP)
C     3.05.90.
C     13.11.92
C     15.06.94
C* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
C*                                                                     *
C*    POPAMMA  SERVCE  PEHAHAEHA  PEAA OOHTEHX   *
C*    BOMOHOCTE POEP BEH O KPBO:                       *
C*                                                                     *
C*       1. OPAOTKA BHOB HAEHHO TOK OOBATEEM.             *
C*       2. TOHEHE TOEK CAMOEPECEEH KPBO.                    *
C*       3. TOHEHE HE AAHHX HK.                          *
C*       4. TOHEHE KCTPEMMOB AAHHX EPEMEHHX.                 *
C*                                                                     *
C*    POPAMMA  SERVCE  BBAETC POPAMMO  BEETLE  CPA OCE    *
C*    TOHEH OEPEHO TOK HA KPBO.                             *
C* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
C*    P MEHEH MAKCMAHOO CA EPEMEHHX- NDIM  HEOXOMO   *
C*    MEHT PAMEPHOCT MACCBA VMOVE (*).                          *
C* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
C
      IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*2 (I-N)
      include 'beetlebf.dim'
      EXTERNAL FUN, DFDX, OUT
      DIMENSION XCRV(1), DFUN(NDIM,NX), IFUNS(1), IVARS(1), IPRNT(1),
     A          INDEX(NPTYP)
      COMMON /WRTO7/ VMOVE(NDIM),VMOVN(NDIM)
      COMMON /LEQV1/ DETL, CONDL
      COMMON /CORR1/ DET,  COND, SGNDET
      COMMON /OUT8/  INDOUT
C
      ISTOP  = 0
      INDOUT = 0
C
C.... AOMHM TEKEE  HOBOE HAEH OPEETE 
C     OCOBEHHOCT MHOPOB, HHX  KOHTPO TOEK
C     CAMOEPECEEH.
C
      RDETL = DETL
      RCONDL= CONDL
      RDET  = DET
      RCOND = COND
C
C.... OOHTEHA OPAOTKA TEKE TOK HA KPBO.
C
      IF (NUF .NE. 0) GOTO 200
          INDEX(1) = 1
          CALL OUT (ISTEP,INDEX,NX,NDIM,XCRV,VMOVE,DFUN,ISTOP)
          IF (ISTOP .NE. 0) RETURN
 200  CONTINUE
C
C.... TOHEHE KOOPHAT HEBX HAEH AAHHX HK.
C
      IPRZ = IPRNT(3)
      CALL ZERO (ISTEP,NX,NDIM,NG,NCAN,NUF,IFUNS,IPRZ,XCRV,EPS,
     A           FUN,DFDX,OUT,DFUN,ISTOP)
      IF (ISTOP .NE. 0) RETURN
C
C.... TOHEHE TOEK CAMOEPECEEH.
C
      DETL = RDETL
      CONDL= RCONDL
      DET  = RDET
      COND = RCOND
C
      IPRCRS = IPRNT(2)
      CALL SLFCRS (ISTEP,NX,NDIM,NG,NCAN,ICRS,IPRCRS,XCRV,EPS,
     A             FUN,DFDX,OUT,DFUN,ISTOP)
      IF (ISTOP .NE. 0) RETURN
C
C.... TOHEHE TOEK KCTPEMMA AAHHX KOOPHAT HA KPBO.
C
      IPRE = IPRNT(4)
      CALL EXTR (ISTEP,NX,NDIM,NG,NCAN,NUE,IVARS,IPRE,XCRV,EPS,
     A           FUN,DFDX,OUT,DFUN,ISTOP)
      IF (ISTOP .NE. 0) RETURN
C
C.... OPMAH BOB POPAMM  OUT -OHOCT AKOHEHA OPAOTKA
C     BCEX TOEK KPBO HA OEPEHOM AE.
C
      INDOUT = 1
      CALL OUT (ISTEP,INDEX,NX,NDIM,XCRV,VMOVE,DFUN,ISTOP)
      RETURN
      END
